<!DOCTYPE html><html lang="es"><head><meta name="head-placeholder"><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name="author" content="Carles Capellas"><meta name="theme-color" content="#000000"><meta name="robots" content="index, follow"><script>"serviceWorker"in navigator&&window.addEventListener("load",(function(){navigator.serviceWorker.register("/sw.js",{scope:"/"})}))</script><link rel="manifest" href="/manifest.json"><link rel="icon" type="image/png" href="/favicon.png"><link rel="stylesheet" href="/main.css"><title>Https, email ready WordPress site on Google Cloud Platform | Carles Capellas</title><meta name="description" content="How to run an HTTPS, email ready wordpress site on Google Cloud Platform" data-react-helmet="true"><meta property="og:site_name" content="Carles Capellas" data-react-helmet="true"><meta property="og:type" content="article" data-react-helmet="true"><meta property="og:title" content="Https, email ready WordPress site on Google Cloud Platform" data-react-helmet="true"><meta property="og:description" content="How to run an HTTPS, email ready wordpress site on Google Cloud Platform" data-react-helmet="true"><meta property="og:url" content="https://capelski.github.io/blog/wordpress-on-google-cloud" data-react-helmet="true"><meta property="og:image" content="https://capelski.github.io/images/blog/wordpress-on-google-cloud/wordpress-site.png" data-react-helmet="true"></head><body><noscript><h1>Carles Capellas</h1><p>JavaScript is required to load my page</p></noscript><div id="app-placeholder"><div class="app-container"><div class="article-container"><div class="section-viewport"><div class="section-content"><div class="article wordpress-on-google-cloud" lang="en"><div class="article-info"><h2 class="article-title">Https, email ready WordPress site on Google Cloud Platform</h2><div class="article-details"><span class="article-date">üìÖ 2020-12-07</span><span class="article-duration">üïê 7 mins</span><span class="article-language selected-language">üåé en</span></div></div><div class="article-body"><p>Need somewhere to host your WordPress site? Google Cloud Platform makes it specially easy, providing pre-configured virtual machines. Your site will be up and running in under an hour, using your custom domain, accepting HTTPS traffic and being able to send emails from contact forms.</p><p><i>Before reading the article be aware that there are many alternatives when it comes to hosting WordPress pages. Having WordPress in GCP is not the cheapest one by far: around 22‚Ç¨/month for a small instance based on my last invoice. If you don't need a dedicated virtual machine consider using other <a href="https://wordpress.org/hosting/" target="_blank">hosting solutions</a>. GCP is a good fit if you are already using it as your cloud infrastructure provider.</i></p><h3>Creating the WordPress site</h3><p>WordPress is written in PHP and runs on <a href="https://www.apache.org/" target="_blank">Apache</a>. You can create a Compute Engine instance (i.e. a virtual machine) yourself and manually install those dependencies or let Google do it for you. I'm a fan of the latter so let's use the GCP Deployment Manager to create our WordPress virtual machine.</p><p>In order to use the deployment manager you will need to enable it's API if you still haven't done so. You can then head to the Marketplace and deploy a solution from there. The one we are looking for is the <b>WordPress Multisite</b> by <b>Google Click to Deploy</b>:</p><div><img class="article-image" src="/images/blog/wordpress-on-google-cloud/deployment-manager-api.png" alt="Enabling Google Cloud deployment manager api"></div><div><img class="article-image" src="/images/blog/wordpress-on-google-cloud/deployment-manager.png" alt="Google Cloud deployment manager"></div><div><img class="article-image" src="/images/blog/wordpress-on-google-cloud/wordpress-marketplace-solution.jpg" alt="Wordpress marketplace solutions"></div><div><img class="article-image" src="/images/blog/wordpress-on-google-cloud/wordpress-multisite.png" alt="Wordpress Multisite marketplace solution"></div><p><i>If Compute Engine hasn't been initialized for the current project, launching the deployment will automatically initialize it. Wait a bit while it does so.</i></p><p>You will next need to give your deployment a name, provide the email of the WordPress site administrator and you are good to go! Make sure you enable the <b>Allow HTTPS traffic from the Internet</b> option if you want your site to be accessible over HTTPS. You can also choose the geographical zone where the virtual machine will be created and pick the machine type (you can see the <b>estimated monthly rate</b> depending on the selected type).</p><div><img class="article-image" src="/images/blog/wordpress-on-google-cloud/wordpress-multisite-config.png" alt="Wordpress Multisite configuration"></div><div><img class="article-image" src="/images/blog/wordpress-on-google-cloud/wordpress-multisite-firewall.png" alt="Wordpress Multisite firewall configuration"></div><div><img class="article-image" src="/images/blog/wordpress-on-google-cloud/wordpress-multisite-deployment.png" alt="Wordpress Multisite deployment"></div><p>When the deployment finishes the details on the right panel will be populated and you will find a new virtual machine in the Compute Engine page. You can access the WordPress site at the external IP address of the virtual machine. If you try to access it over HTTPS however, the page will fail to load and you will get a connection timed out error.</p><div><img class="article-image" src="/images/blog/wordpress-on-google-cloud/wordpress-multisite-instance.png" alt="Wordpress multisite compute engine instance"></div><h3>Enabling HTTPS traffic</h3><p>In order to enable the HTTPS traffic there are a few additional steps that must be covered. To begin with, SSL certificates can't be issued to IP addresses; we need to set up a domain name for the site. First we need to make the virtual machine external IP address static (otherwise the IP address might eventually change over time). Head to <b>VPC Network</b> &gt; <b>External IP addresses</b> and select Static for the corresponding address:</p><div><img class="article-image" src="/images/blog/wordpress-on-google-cloud/vpc-network.png" alt="Google Cloud VPC networks"></div><div><img class="article-image" src="/images/blog/wordpress-on-google-cloud/static-ip-address.png" alt="Google Cloud external IP addresses"></div><p>Having an static IP address we can use it to point our domain name to. This needs to be done from the domain registrar where you purchased the domain name in. Each registrar has a different user interface. Search for the DNS management section and create an A record to point to the static IP address. After the changes are propagated you should be able to access your site through the domain name over HTTP:</p><div><img class="article-image with-footer" src="/images/blog/wordpress-on-google-cloud/dns-a-record.png" alt="DNS A record creation"><p class="article-image-footer">DNS record creation example in DonDominio spanish registrar. Interface will be different for other registrars</p></div><div><img class="article-image with-footer" src="/images/blog/wordpress-on-google-cloud/wordpress-site.png" alt="Deployed wordpress site"><p class="article-image-footer">I'm using carlescapellas.xyz domain temporarily for the tutorial. It won't be accessible later on</p></div><p>Ok! Let's get the HTTPS running and move on to something else before we lose heart. We will do so by generating an SSL certificate with <a href="https://certbot.eff.org/" target="_blank">certbot</a>. There is a great guide on how to do it in <a href="https://onepagezen.com/free-ssl-certificates-wordpress-google-cloud-click-to-deploy" target="_blank">OnePageZen</a>. Here are the summarized steps (check the guide for more details):</p><ul><li>Connect to the virtual machine through SSH (from the Compute Engine page)</li><li>Download and install certbot-auto<div class="article-code-snippet">sudo apt-get install certbot python-certbot-apache -t stretch-backports</div></li><li>Generate an SSL certificate<div class="article-code-snippet">sudo certbot --apache</div></li><li>Restart Apache server<div class="article-code-snippet">sudo service apache2 restart</div></li><li>Update WordPress URLs. Log in to the WordPress site using the credentials you will find in the right panel of the deployment manager. Navigate to settings and set both <b>WordPress Address (URL)</b> and <b>Site Address (URL)</b> to the HTTPS version of your domain:<div><img class="article-image" src="/images/blog/wordpress-on-google-cloud/wordpress-deployment-credentials.png" alt="Wordpress multisite deployment credentials"></div><div><img class="article-image" src="/images/blog/wordpress-on-google-cloud/wordpress-site-urls.png" alt="Wordpress site urls settings"></div></li></ul><p>Save the changes and celebrate while you access your site over HTTPS üçæ You are almost done with the site configuration. There is one last aspect we need to consider before you start playing with the wordpress site customization: emails sending.</p><h3>Sending emails from WordPress</h3><p>WordPress has a variety of plugins to easily create contact forms and send the inquiries by email (e.g. <a href="https://wpforms.com/" target="_blank">wpforms</a>). However, most of those plugins rely on sending emails through TCP port 25 which, on GCP virtual machines, is always blocked due to the risk of abuse.</p><p>The easiest way for the emails to make it through the GCP firewall is to use a third-party email service provider. There are three different providers available. I went with <a href="https://www.mailgun.com/" target="_blank">Mailgun</a> (the free tier offers up to 10,000 emails per month) but you can use <a href="https://sendgrid.com/" target="_blank">SendGrid</a> or<a href="https://www.mailjet.com/" target="_blank">Mailjet</a> if you like them better.</p><p>Before start configuring any of those services, we need to create a new rule in the firewall to allow outbound traffic. Any port other than 25 would do the trick, but we will use 2525 because Mailgun listens on that port. This is done from the <b>VPC Network</b> &gt; <b>Firewall</b> page and it's described in <a href="https://cloud.google.com/compute/docs/tutorials/sending-mail#email_custom_port" target="_blank">this section</a> of the GCP documentation:</p><div><img class="article-image" src="/images/blog/wordpress-on-google-cloud/firewall-rule-creation.png" alt="Google Cloud firewall rule creation"></div><div><img class="article-image" src="/images/blog/wordpress-on-google-cloud/firewall-rule-config.png" alt="Google Cloud firewall rule configuration"></div><div><img class="article-image" src="/images/blog/wordpress-on-google-cloud/firewall-email-rule.png" alt="Google Cloud firewall rules"></div><p>Next we need to configure the email provider. First head to Mailgun (or the provider of your choice), create and account and add a domain in the <b>Sending</b> &gt; <b>Domains</b> section. As recommended by Mailgun, you should use a subdomain (<i>e.g. mg.your-domain.com</i>) as the domain name.</p><div><img class="article-image" src="/images/blog/wordpress-on-google-cloud/mailgun-domains.png" alt="Mailgun domains dashboard"></div><div><img class="article-image" src="/images/blog/wordpress-on-google-cloud/mailgun-domain-config.png" alt="Mailgun domain creation"></div><p>Again, you will then need to create some DNS records in your domain registrar. Mailgun provides descriptive information on how to do it right after adding the domain (you will later find this page in <b>Domain settings</b> &gt; <b>DNS Records</b>). The only mandatory records are the first two TXT. Don't create the MX records if you have already configured email for your domain with a different provider. Optionally create the CNAME record if you want to enable tracking functionalities.</p><div><img class="article-image" src="/images/blog/wordpress-on-google-cloud/mailgun-domain-verification.png" alt="Mailgun domain verification steps"></div><div><img class="article-image with-footer" src="/images/blog/wordpress-on-google-cloud/dns-txt-record.png" alt="DNS TXT record creation"><p class="article-image-footer">TXT DNS record creation example in DonDominio spanish registrar</p></div><div><img class="article-image with-footer" src="/images/blog/wordpress-on-google-cloud/mailgun-verification-email.png" alt="Mailgun domain verification email"><p class="article-image-footer">Mailgun successful domain verification email</p></div><p>Once the domain has been added and verified we will need to get the SMTP credentials for later use when configuring the service (not the Mailgun user credentials). You can find them in <b>Domain settings</b> &gt; <b>SMTP credentials</b>. The login is likely to be<i>postmaster@mg.your-domain.com</i> and the password can be retrieved by resetting it (it will only be displayed once, so store it in a safe location).</p><div><img class="article-image with-footer" src="/images/blog/wordpress-on-google-cloud/mailgun-smtp-credentials.png" alt="Mailgun SMTP credentials sections"><p class="article-image-footer">Mailgun SMTP credentials section</p></div><p>Having your credentials ready there is only one thing left to do: configuring the service in the virtual machine üí™ The steps are explained in great detail in the <a href="https://cloud.google.com/compute/docs/tutorials/sending-mail/using-mailgun" target="_blank">GCP official documentation</a>. It's just a matter of executing the provided commands through an SSH terminal, so I won't duplicate the steps here. In step 8 you will need to use the SMTP credentials collected above.</p><p><b>Important!</b> If you select EU as the Domain zone when adding the domain name in Mailgun, replace <i>smtp.mailgun.org</i> with <i>smtp.eu.mailgun.org</i> (steps 6 and 8). Not doing so will lead to <i>535 Authentication failed</i> errors when trying to send emails (step 13) and countless hours of frustration while searching for a solution to the problem in StackOverflow.</p><p>And that's pretty much it üéâ You can now sit back and relax. You have accomplished enough for today: creating a WordPress site, accepting HTTPS traffic and enabling emails sending. From here on is up to the marketing guys to choose a nice template, fill the pages with content and tell all of their friends they are now developing websites.</p><h3 class="posts-timeline">Posts timeline</h3><div class="article-links"><div class="previous-link"><span class="link-text"><a href="/blog/npm-packages-development">‚¨ÖÔ∏è Previous</a><div class="title-preview">Create your own npm package</div></span></div><div class="next-link"><span class="link-text"><a href="/blog/android-app-publishing">Following ‚û°Ô∏è</a><div class="title-preview">Publishing an Android app to Play Store</div></span></div></div></div></div></div></div><div class="section-links"><a aria-current="page" class="link active" href="/blog">‚¨ÖÔ∏è Blog</a></div></div></div></div><script src="/main.js"></script></body></html>